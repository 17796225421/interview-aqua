为什么需要 **TIME_WAIT** ？
需要 **TIME_WAIT** 状态，主要是两个原因：

- 防止具有相同四元组的「旧」数据包被收到；
- 保证「被动关闭连接」的一方能被正确的关闭，即保证最后的 `ACK` 能让被动关闭方接收，从而帮助其正常关闭；

[原因1]：如果没有 **TIME_WAIT** 或者这个状态时间太短。那么在这个四元组关闭之前发出的消息，有可能在这组四元组被复用重新建立连接后，之前延迟的报文到达这对新的连接，那么会导致新的连接数据错乱。

因此，TCP设计了这么一个状态，经过 **2MSL** 的时间，足以让两个方向上的数据包都在网络中消失，再出现的数据包一定是新建立的连接产生的。

[原因2]：如果在第四次握手中，客户端发送的最后一个**ACK**在网络中丢失了。如果没有这个状态或者这个状态时间过短，直接进入**CLOSED**状态，那么服务端就会一直处于**LAST_ACK**状态。如此，当客户端发起**SYN**建立连接请求，服务端会发送**RST**报文给客户端，无法建立连接。

因此，设计这个状态：如果服务端正常收到四次挥手的最后一个 `ACK` 报文，则服务端正常关闭连接。否则服务端没有收到四次挥手的最后一个 `ACK` 报文时，则会重发 `FIN` 关闭连接报文并等待新的 `ACK` 报文。

> **MSL** 是 **Maximum Segment Lifetime** ，报文最大生存时间，它是任何报文在网络上存在的最长时间，超过这个时间报文将被丢弃