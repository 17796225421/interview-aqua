



------

## 虚拟内存

> 我们再来瞧一瞧，Linux 的虚拟地址空间是如何分布的？

在 Linux 操作系统中，虚拟地址空间的内部又被分为**内核空间和用户空间**两部分，不同位数的系统，地址空间的范围也不同。比如最常见的 32 位和 64 位系统，如下所示：

![图片](image/640.webp)用户空间与内存空间

通过这里可以看出：

- `32` 位系统的内核空间占用 `1G`，位于最高处，剩下的 `3G` 是用户空间；
- `64` 位系统的内核空间和用户空间都是 `128T`，分别占据整个内存空间的最高和最低处，剩下的中间部分是未定义的。



虚拟内存为每个进程提供了一个大的、独立的、一致的地址空间。

- 在主存中只保存活动区域，在磁盘和主存之间通过缺页中断来回传送数据， 高效地使用了主存，等效地扩大了内存空间
- 它为每个进程提供了一致的地址空间， 从而简化了内存管理
- 它保护了每个进程的地址空间不被其他进程破坏

### 虚拟地址空间

[![img](image/进程地址空间.jpg)](https://github.com/szza/LearningNote/blob/master/1.面试总结/image/进程地址空间.jpg)

通过这张图你可以看到，用户空间内存，从**低到高**分别是 7 种不同的内存段：

- 程序文件段，包括二进制可执行代码；
- 已初始化数据段，包括静态常量；
- 未初始化数据段，包括未初始化的静态变量；
- 堆段，包括动态分配的内存，从低地址开始向上增长；
- 文件映射段，包括动态库、共享内存等，从低地址开始向上增长（跟硬件和内核版本有关）
- 栈段，包括局部变量和函数调用的上下文等。栈的大小是固定的，一般是 `8 MB`。当然系统也提供了参数，以便我们自定义大小；

